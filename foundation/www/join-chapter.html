{% extends "templates/web.html" %}

{% block page_content %}
{% if frappe.session.user=='Guest' %}
	<p>Please signup and login to join this chapter</p>
	<p><a href="/login?redirect-to=/{{ chapter.route }}" class='btn btn-primary'>Login</a></p>
{% else %}
	{% if already_member %}
	<p>You are already a member of {{ chapter.title }}!</p>
	{% else %}
	<p>Welcome to chapter {{ chapter.title }}!</p>
	{% endif %}
	<div style="padding: 20px 0;">
		<div class="row">
			<div class="col-lg-8 col-md-8">
				<form name="user-intro">
					<div class="form-group">
						<input id="chapter_name" name="chapter_name" class="form-control" type="text" value={{chapter.name}} />
					</div>
					<div class="form-group">
						<label  for="username" class="">User Name</label>
						<input id="username" name="username" class="form-control" type="text" value={{ frappe.session.user }} />
					</div>
					<div class="form-group">
						<label for="weburl" class="">Website URL</label>
						<input id="weburl" name="weburl" class="form-control" type="text" placeholder="Please Enter website URL" />
					</div>
					<div class="form-group">
						<label for="introduction" class="">Introduction</label>
						<textarea id="introduction" name="introduction" class="form-control" placeholder="Please Enter your Introduction"></textarea>
					</div>
					<div class="form-group">
						<button type="Submit" id="update_member" class="btn-primary">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<p><a href="/{{ chapter.route }}" class='btn btn-primary'>Go to Chapter Page</a></p>
{% endif %}

<script>

frappe.ready(function() {

	// $("#reset-password").on("submit", function() {
	// 	return false;
	// });

	// $("#new_password").on("press", function(e) {
	// 	if(e.which===13) $("#update").click();
	// })

	$("#update_member").click(function() {
		var args = {
			: get_url_arg("key") || "",
			weburl: $("#weburl").val(),
			introduction: $("#introduction").val()
		}

		// if(!args.old_password && !args.key) {
		// 	frappe.msgprint("Old Password Required.");
		// 	return;
		// }
		// if(!args.new_password) {
		// 	frappe.msgprint("New Password Required.")
		// 	return;
		// }

		frappe.call({
			type: "POST",
			method: "frappe.core.doctype.user.user.update_password",
			btn: $("#update"),
			args: args,
			statusCode: {
				401: function() {
					$('.page-card-head .indicator').removeClass().addClass('indicator red')
						.text(__('Invalid Password'));
				},
				200: function(r) {
					$("input").val("");
					// strength_indicator.addClass('hidden');
					// strength_message.addClass('hidden');
					$('.page-card-head .indicator')
						// .removeClass().addClass('indicator green')
						.html(__('Password Updated'));
					if(r.message) {
						frappe.msgprint(__("Password Updated"));
	                    setTimeout(function() {
							window.location.href = r.message;
	                    }, 2000);
					}
				}
			}
		});

        return false;
	});

	// window.strength_indicator = $('.password-strength-indicator');
	// window.strength_message = $('.password-strength-message');

	// $('#new_password').on('keyup', function() {
		// window.clear_timeout();
		// window.timout_password_strength = setTimeout(window.test_password_strength, 200);
	// });

	// window.test_password_strength = function() {
	// 	window.timout_password_strength = null;

	// 	var args = {
	// 		key: get_url_arg("key") || "",
	// 		old_password: $("#old_password").val(),
	// 		new_password: $("#new_password").val()
	// 	}

	// 	if (!args.new_password) {
	// 		set_strength_indicator('grey', {'warning': __('Please enter the password') });
	// 		return;
	// 	}

	// 	return frappe.call({
	// 		type: 'GET',
	// 		method: 'frappe.core.doctype.user.user.test_password_strength',
	// 		args: args,
	// 		callback: function(r) {
	// 			// console.log(r.message);
	// 		},
	// 		statusCode: {
	// 			401: function() {
	// 				$('.page-card-head .indicator').removeClass().addClass('indicator red')
	// 					.text(__('Invalid Password'));
	// 			},
	// 			200: function(r) {
	// 				if (r.message && r.message.entropy) {
	// 					var score = r.message.score,
	// 						feedback = r.message.feedback;

	// 					feedback.crack_time_display = r.message.crack_time_display;
	// 					feedback.score = score;

	// 					if(feedback.password_policy_validation_passed){
	// 						set_strength_indicator('green', feedback);
	// 					}else{
	// 						set_strength_indicator('red', feedback);
	// 					}
	// 				}
	// 			}
	// 		}

	// 	});
	// };

	// window.set_strength_indicator = function(color, feedback) {
	// 	var message = [];
	// 	feedback.help_msg = "";
	// 	if(!feedback.password_policy_validation_passed){
	// 		feedback.help_msg = __("Hint: Include symbols, numbers and capital letters in the password");
	// 	}
	// 	if (feedback) {
	// 		if(!feedback.password_policy_validation_passed){
	// 			if (feedback.suggestions && feedback.suggestions.length) {
	// 				feedback.suggestions = feedback.suggestions + ' ' + feedback.help_msg;
	// 				message = message.concat(feedback.suggestions);
	// 			} else if (feedback.warning) {
	// 				feedback.warning = feedback.warning + ' ' + feedback.help_msg;
	// 				message.push(feedback.warning);
	// 			}

	// 			if (!message.length) {
	// 				message.push(feedback.help_msg);
	// 			}
	// 		}else{
	// 			message.push(__('Success! You are good to go üëç'));
	// 		}
	// 	}

	// 	strength_indicator.removeClass().addClass('password-strength-indicator indicator ' + color);
	// 	strength_message.text(message.join(' ') || '').removeClass('hidden');
	// 	// strength_indicator.attr('title', message.join(' ') || '');
	// }

	window.clear_timeout = function() {
		if (window.timout_password_strength) {
			clearTimeout(window.timout_password_strength);
			window.timout_password_strength = null;
		}
	};
});

</script>

{% endblock %}